<!doctype html>
<html>
<head>
  <title>Ludum Dare 34</title>
  <style>
    * {
      padding: 0; margin:0;
    }
    @font-face {
    font-family: Pixel;
    src: url('font/prstartk.ttf');
    }
    canvas {
      background: #eee;
      display: block;
      margin: auto;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="640" height="360"></canvas>
  
  
  <script type="text/javascript" src="js/MoveableEntity.js"></script>
  <script type="text/javascript" src="js/Player.js"></script>
  <script type="text/javascript" src="js/Asteroid.js"></script>
  <script type="text/javascript" src="js/Laser.js"></script>
  <script type="text/javascript" src="js/Engine.js"></script>
  <script type="text/javascript" src="js/Pickup.js"></script>
  
  <script type="text/javascript" src="js/buckets.js"></script> <!--Data structure lib -->
  <script type="text/javascript" src="js/PxLoader.js"></script>
  <script type="text/javascript" src="js/PxLoaderImage.js"></script>
  <script>
    console.log("Initializing...");
    
    //Amount to scale rendering from the "actual" resolution
    var screenScale = 1;
    
    /*Get a reference to the HTML canvas and a 2D rendering context*/
    var canvas = document.getElementById("gameCanvas");
    var ctx = canvas.getContext("2d");
    ctx.imageSmoothingEnabled = false; //Display pixellated images
    ctx.scale(screenScale,screenScale);
    
    //Suppress right click
    canvas.oncontextmenu = function (e) {
      e.preventDefault();
    };
             
    /*Global variables*/
    var PX_WIDTH = 640;
    var PX_HEIGHT = 360;
  
    //Inputs
    var rightPressed = false;
    var leftPressed = false;
    var spacePressed = false;
    var upPressed = false;
    var lmbPressed = false;
    var rmbPressed = false;
    var mouseX = 0;
    var mouseY = 0;
    var mouseMoved = false;
        
    //Timing
    var time;
    var dt;
    
    //Input
    document.addEventListener("keydown", keyDownHandler, false);
    document.addEventListener("keyup", keyUpHandler, false);
    document.addEventListener("mousemove", mouseMoveHandler, false);
    window.addEventListener("mousedown", mouseDownHandler, false);
    window.addEventListener("mouseup", mouseUpHandler, false);
    
    function keyDownHandler(e) {
      if(e.keyCode == 39) {
        rightPressed = true;
      }
      else if(e.keyCode == 37) {
        leftPressed = true;
      }
      else if(e.keyCode == 38) {
        upPressed = true;
      }
      else if(e.keyCode == 32) {
        spacePressed = true;
      }
    }
    function keyUpHandler(e) {
      if(e.keyCode == 39) {
        rightPressed = false;
      }
      else if(e.keyCode == 37) {
        leftPressed = false;
      }
      else if(e.keyCode == 38) {
        upPressed = false;
      }
      else if(e.keyCode == 32) {
        spacePressed = false;
      }
    }
    function mouseDownHandler(e) {
      if(e.button == 0 || e.button == 1){
        lmbPressed = true;
      }
      else if(e.button == 2){
        rmbPressed = true;
      }
    }
    function mouseUpHandler(e) {
      if(e.button === 0 || e.button === 1){
        console.log("lmb released");
        lmbPressed = false;
      }
      else if(e.button === 2){
        console.log("rmb released");
        rmbPressed = false;
      }
    }
    function mouseMoveHandler(e) {
      mouseX = (event.pageX - canvas.offsetLeft)*screenScale;
      mouseY = (event.pageY - canvas.offsetTop)*screenScale;
      mouseMoved = true;
    }

    console.log("Loading assets");
    var loader = new PxLoader();
    var imgStarscape = loader.addImage("img/stars.png");
    var imgShip      = loader.addImage("img/ship.png");
    var imgShipFly   = loader.addImage("img/ship_fly.png");
    var imgCrosshair   = loader.addImage("img/crosshair.png");
    
    var imgAsteroid1   = loader.addImage("img/asteroid1.png");
    var imgAsteroid2   = loader.addImage("img/asteroid2.png");
    var imgAsteroid3   = loader.addImage("img/asteroid3.png");
    var imgAsteroid4   = loader.addImage("img/asteroid4.png");
    
    var imgHealth   = loader.addImage("img/health.png");
    var imgJunk   = loader.addImage("img/junk.png");
    
    loader.addCompletionListener(function() {

      console.log("Starting game loop...");
      new Engine();
    });
    
    loader.start();
  </script>
</body>
</html>
